<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      :root {
        --bg: #121213;
        --text: #e5e5e5;
        --neutral: #1f1f20;
        --correct: #538d4e;
        --present: #b59f3b;
        --absent: #3a3a3c;
      }
      body { margin: 0; background: transparent; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
      .mw-kb { display: flex; flex-direction: column; gap: 6px; align-items: center; padding: 4px 0; }
      .mw-kb-row { display: flex; gap: 4px; }
      .mw-key {
        min-width: 30px; padding: 8px 6px; border-radius: 6px; border: none; cursor: pointer;
        background: var(--neutral); color: var(--text); font-weight: 700; font-size: 14px; text-align: center;
        transition: transform 0.05s ease, filter 0.15s ease;
      }
      .mw-key.correct { background: var(--correct); }
      .mw-key.present { background: var(--present); }
      .mw-key.absent  { background: var(--absent); }
      .mw-key:active { transform: translateY(1px); filter: brightness(0.95); }
      .mw-key:disabled { opacity: 0.6; cursor: default; }
      @media (max-width: 420px) { .mw-key { min-width: 26px; font-size: 13px; padding: 7px 5px; } }
    </style>
  </head>
  <body>
    <div id="root"></div>
    <script>
      const root = document.getElementById('root');

      function post(type, payload) {
        window.parent.postMessage({ type, ...payload }, '*');
      }

      function keyButton(label, status, disabled) {
        const b = document.createElement('button');
        b.className = 'mw-key ' + (status || '');
        b.textContent = label;
        if (disabled) b.disabled = true;
        b.onclick = () => {
          const val = (label === 'ENTER') ? 'ENTER' : (label === '⌫' ? 'BACK' : label);
          post('streamlit:setComponentValue', { value: val, dataType: 'json' });
        };
        return b;
      }

      function render(args) {
        const rows = args.rows || ["QWERTYUIOP","ASDFGHJKL","ZXCVBNM"]; 
        const statuses = args.statuses || {}; // {A:'correct', ...}
        const disableEnter = !!args.disableEnter;
        const disableBackspace = !!args.disableBackspace;

        root.innerHTML = '';
        const kb = document.createElement('div');
        kb.className = 'mw-kb';
        rows.forEach((row, idx) => {
          const r = document.createElement('div');
          r.className = 'mw-kb-row';
          if (idx === 2) r.appendChild(keyButton('ENTER', '', disableEnter));
          for (const ch of row) {
            r.appendChild(keyButton(ch, statuses[ch] || '', false));
          }
          if (idx === 2) r.appendChild(keyButton('⌫', '', disableBackspace));
          kb.appendChild(r);
        });
        root.appendChild(kb);
        // Adjust height for Streamlit container
        const h = Math.ceil(kb.getBoundingClientRect().height) + 8;
        post('streamlit:setFrameHeight', { height: h });
      }

      window.addEventListener('message', (event) => {
        const msg = event.data || {};
        if (msg.type === 'streamlit:render') {
          render(msg.args || {});
        }
      });

      // Signal ready
      post('streamlit:componentReady', { apiVersion: 1 });
    </script>
  </body>
  </html>
